<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WebAR TTRPG Game - Dual Scene</title>
    
    <!-- Three.js (needed for game scene) -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    
    <!-- A-Frame and MindAR (for AR tracking) -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        /* Game container for Three.js overlay */
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* A-Frame scene behind game scene */
        a-scene {
            z-index: -1 !important;
        }

        #info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            z-index: 1000;
            font-size: 14px;
        }

        #examples-link {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(100, 149, 237, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            text-decoration: none;
            z-index: 1000;
            font-size: 12px;
        }

        #examples-link:hover {
            background: rgba(100, 149, 237, 1);
        }

        /* Debug Panel */
        #debug {
            position: fixed;
            top: 80px;
            left: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: #00ff00;
            padding: 20px;
            border: 2px solid #00ff00;
            border-radius: 8px;
            font-size: 16px;
            z-index: 1000;
            min-width: 350px;
            font-family: 'Courier New', monospace;
        }

        #debug h2 {
            margin: 0 0 15px 0;
            font-size: 18px;
            border-bottom: 1px solid #00ff00;
            padding-bottom: 8px;
        }

        .row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px;
            background: rgba(0, 255, 0, 0.05);
        }

        .label {
            color: #888;
        }

        .value {
            color: #00ff00;
            font-weight: bold;
            font-size: 18px;
        }

        #status {
            padding: 10px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            border-radius: 4px;
        }

        .tracking {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #00ff00;
            color: #00ff00;
        }

        .lost {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff0000;
            color: #ff0000;
        }
    </style>
</head>
<body>
    <div id="info">
        üéÆ WebAR TTRPG Game - Dual Scene<br>
        <small>AR Tracking + Separate Game Renderer</small>
    </div>

    <a href="examples/example-minimal.html" id="examples-link">
        üìö View Examples
    </a>

    <!-- Debug Overlay -->
    <div id="debug">
        <h2>üì° MINIMAL EXAMPLE</h2>
        
        <div id="status" class="lost">NOT TRACKING</div>
        
        <h3 style="margin-top: 10px; margin-bottom: 5px; font-size: 14px;">Position</h3>
        <div class="row">
            <span class="label">X:</span>
            <span id="pos-x" class="value">0.000</span>
        </div>
        <div class="row">
            <span class="label">Y:</span>
            <span id="pos-y" class="value">0.000</span>
        </div>
        <div class="row">
            <span class="label">Z:</span>
            <span id="pos-z" class="value">0.000</span>
        </div>
        
        <h3 style="margin-top: 10px; margin-bottom: 5px; font-size: 14px;">Rotation (Euler)</h3>
        <div class="row">
            <span class="label">X:</span>
            <span id="rot-x" class="value">0.0¬∞</span>
        </div>
        <div class="row">
            <span class="label">Y:</span>
            <span id="rot-y" class="value">0.0¬∞</span>
        </div>
        <div class="row">
            <span class="label">Z:</span>
            <span id="rot-z" class="value">0.0¬∞</span>
        </div>
        
        <h3 style="margin-top: 10px; margin-bottom: 5px; font-size: 14px;">Rotation (Quaternion)</h3>
        <div class="row">
            <span class="label">X:</span>
            <span id="quat-x" class="value">0.000</span>
        </div>
        <div class="row">
            <span class="label">Y:</span>
            <span id="quat-y" class="value">0.000</span>
        </div>
        <div class="row">
            <span class="label">Z:</span>
            <span id="quat-z" class="value">0.000</span>
        </div>
        <div class="row">
            <span class="label">W:</span>
            <span id="quat-w" class="value">1.000</span>
        </div>
    </div>

    <!-- Game Container (Three.js overlay) -->
    <div id="game-container"></div>

    <!-- A-Frame Scene with MindAR (for tracking only) -->
    <a-scene 
        mindar-image="imageTargetSrc: ./assets/targets.mind;" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false">
        
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
        
        <!-- AR Target 0: Tracking anchor with blue rectangle -->
        <a-entity id="ar-target" mindar-image-target="targetIndex: 0">
            <a-plane color="blue" opacity="0.5" position="0 0 0" height="0.552" width="1" rotation="0 0 0"></a-plane>
        </a-entity>
    </a-scene>

    <!-- Game Controller (ES6 Module) -->
    <script type="module">
        import { GameController } from './src/game-controller.js';
        
        console.log('üéÆ WebAR TTRPG Game starting...');
        console.log('üì° Scene 1: AR Tracking (MindAR A-Frame)');
        console.log('üé® Scene 2: Game Rendering (Three.js)');
        
        // Get UI elements
        const statusEl = document.getElementById('status');
        const posX = document.getElementById('pos-x');
        const posY = document.getElementById('pos-y');
        const posZ = document.getElementById('pos-z');
        const rotX = document.getElementById('rot-x');
        const rotY = document.getElementById('rot-y');
        const rotZ = document.getElementById('rot-z');
        const quatX = document.getElementById('quat-x');
        const quatY = document.getElementById('quat-y');
        const quatZ = document.getElementById('quat-z');
        const quatW = document.getElementById('quat-w');
        
        // Initialize game controller
        const gameController = new GameController();
        await gameController.init();
        
        // Update debug UI every frame
        let lastLogTime = 0;
        function updateDebugUI() {
            const tracking = gameController.getARTracking().getTrackingStatus();
            
            if (tracking.isTracking) {
                statusEl.textContent = '‚úÖ TRACKING';
                statusEl.className = 'tracking';
                
                const pos = tracking.position;
                const quat = tracking.quaternion;
                
                // Convert quaternion to Euler for display (easier to read)
                const euler = new THREE.Euler();
                euler.setFromQuaternion(quat);
                
                // Update position
                posX.textContent = pos.x.toFixed(3);
                posY.textContent = pos.y.toFixed(3);
                posZ.textContent = pos.z.toFixed(3);
                
                // Update Euler rotation
                rotX.textContent = (euler.x * 180 / Math.PI).toFixed(1) + '¬∞';
                rotY.textContent = (euler.y * 180 / Math.PI).toFixed(1) + '¬∞';
                rotZ.textContent = (euler.z * 180 / Math.PI).toFixed(1) + '¬∞';
                
                // Update quaternion
                quatX.textContent = quat.x.toFixed(3);
                quatY.textContent = quat.y.toFixed(3);
                quatZ.textContent = quat.z.toFixed(3);
                quatW.textContent = quat.w.toFixed(3);
                
                // Log tracking data every 2 seconds
                const now = Date.now();
                if (now - lastLogTime > 2000) {
                    console.log('üìä Tracking Data:', {
                        position: { x: pos.x, y: pos.y, z: pos.z },
                        quaternion: { x: quat.x, y: quat.y, z: quat.z, w: quat.w },
                        rotation: { 
                            x: (euler.x * 180 / Math.PI).toFixed(1) + '¬∞',
                            y: (euler.y * 180 / Math.PI).toFixed(1) + '¬∞',
                            z: (euler.z * 180 / Math.PI).toFixed(1) + '¬∞'
                        }
                    });
                    lastLogTime = now;
                }
            } else {
                statusEl.textContent = '‚ùå NOT TRACKING';
                statusEl.className = 'lost';
            }
            
            requestAnimationFrame(updateDebugUI);
        }
        
        updateDebugUI();
        
        // Make accessible for debugging
        window.gameController = gameController;
        
        console.log('‚úÖ Dual scene system ready!');
    </script>
</body>
</html>
